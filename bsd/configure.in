AC_INIT(krlogind.c)
WITH_CCOPTS
ISODE_DEFS
ISODE_INCLUDE
CONFIG_RULES
AC_SET_BUILDTOP
AC_PROG_INSTALL
AC_HAVE_LIBRARY(socket)
AC_HAVE_LIBRARY(nsl)
dnl dbm libs for use of an_to_ln
AC_HAVE_LIBRARY(-lndbm)
AC_HAVE_LIBRARY(-ldbm)
dnl
dnl AIX has them all; SCO might too
LOGINLIBS=
AC_HAVE_LIBRARY(-lodm,
  AC_HAVE_LIBRARY(-ls,
    AC_HAVE_LIBRARY(-lcfg, 
      LOGINLIBS="-lodm -ls -lcfg" 
      )))
AC_SUBST(LOGINLIBS)
dnl
AC_VFORK
AC_FUNC_CHECK(strsave,AC_DEFINE(HAS_STRSAVE))
AC_FUNC_CHECK(utimes,AC_DEFINE(HAS_UTIMES))
AC_FUNC_CHECK(getutent,AC_DEFINE(HAVE_GETUTENT))
AC_FUNC_CHECK(setreuid,AC_DEFINE(HAVE_SETREUID))
AC_FUNC_CHECK(gettosbyname,AC_DEFINE(HAVE_GETTOSBYNAME))
AC_FUNC_CHECK(killpg,AC_DEFINE(HAVE_KILLPG))
AC_FUNC_CHECK(getdtablesize,AC_DEFINE(HAVE_GETDTABLESIZE))
AC_FUNC_CHECK(initgroups,AC_DEFINE(HAVE_INITGROUPS))
AC_FUNC_CHECK(setpriority,AC_DEFINE(HAVE_SETPRIORITY))
AC_FUNC_CHECK(setreuid,AC_DEFINE(HAVE_SETREUID))
AC_FUNC_CHECK(setresuid,AC_DEFINE(HAVE_SETRESUID))
dnl if srand48 is there, use it (krlogind needs it)
AC_FUNC_CHECK(srand48,AC_DEFINE(srandom,srand48) AC_DEFINE(random,lrand48))
AC_FUNC_CHECK(sigprocmask,
AC_COMPILE_CHECK([sigset_t],
[#include <signal.h>],
[sigset_t x],
AC_DEFINE(POSIX_SIGNALS)))
AC_HAVE_HEADERS(sys/filio.h sys/sockio.h unistd.h sys/label.h ttyent.h sys/ptyvar.h lastlog.h sys/select.h sys/tty.h sys/ttold.h)
AC_REPLACE_FUNCS(getdtablesize)
CHECK_DIRENT
CHECK_FCNTL
CHECK_WAIT_TYPE
AC_WAIT3
AC_HEADER_CHECK(termios.h,AC_FUNC_CHECK([tcsetattr],AC_DEFINE(POSIX_TERMIOS)))
AC_COMPILE_CHECK([F_SETOWN],
[#include <sys/types.h>
#include <fcntl.h>],
[1+F_SETOWN;], 
AC_DEFINE(HAVE_SETOWN))
AC_COMPILE_CHECK([ut_host in struct utmp],
[#include <utmp.h>],
[struct utmp ut; ut.ut_host;],
,
AC_DEFINE(NO_UT_HOST))
AC_COMPILE_CHECK([ut_exit in struct utmp],
[#include <utmp.h>],
[struct utmp ut; ut.ut_exit;],
,
AC_DEFINE(NO_UT_EXIT))
AC_COMPILE_CHECK([ut_pid in struct utmp],
[#include <utmp.h>],
[struct utmp ut; ut.ut_pid;],
,
AC_DEFINE(NO_UT_PID))
KRB_INCLUDE
WITH_KRB5ROOT
WITH_KRB4
AC_WITH([krb4],
ADD_DEF(-DKRB5_KRB4_COMPAT)
K4LIB='$(KRB4)/lib/libkrb.a $(KRB4)/lib/libdes.a',
echo "warning: no krb4 backwards compatibility support"
K4LIB=)
AC_SUBST(K4LIB)
AC_COMPILE_CHECK([setenv],
[setenv();],[setenv("PATH","/bin",0)],,
[SETENVSRC=setenv.c
SETENVOBJ=setenv.o
AC_SUBST([SETENVSRC])
AC_SUBST([SETENVOBJ])])
dnl
AC_COMPILE_CHECK([number of arguments to getpgrp],
[#include <unistd.h>],[int pid = getpgrp()],
AC_DEFINE(GETGRP_ONEARG))
AC_COMPILE_CHECK([number of arguments to setpgrp],
[#include <unistd.h>],[setpgrp(0,0)],
AC_DEFINE(SETPGRP_TWOARG))
dnl
ADD_DEF(-DKERBEROS)
AC_OUTPUT(Makefile,[EXTRA_RULES])
